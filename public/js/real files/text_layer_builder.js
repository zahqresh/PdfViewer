"use strict";function DefaultTextLayerFactory(){}var TextLayerBuilder=function(){function n(n){this.textLayerDiv=n.textLayerDiv;this.renderingDone=!1;this.divContentDone=!1;this.pageIdx=n.pageIndex;this.pageNumber=this.pageIdx+1;this.matches=[];this.viewport=n.viewport;this.textDivs=[];this.findController=n.findController||null;this.textLayerRenderTask=null;this._bindMouse()}return n.prototype={_finishRendering:function(){var n,t;this.renderingDone=!0;n=document.createElement("div");n.className="endOfContent";this.textLayerDiv.appendChild(n);t=document.createEvent("CustomEvent");t.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:this.pageNumber});this.textLayerDiv.dispatchEvent(t)},render:function(n){if(this.divContentDone&&!this.renderingDone){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null);this.textDivs=[];var t=document.createDocumentFragment();this.textLayerRenderTask=PDFJS.renderTextLayer({textContent:this.textContent,container:t,viewport:this.viewport,textDivs:this.textDivs,timeout:n});this.textLayerRenderTask.promise.then(function(){this.textLayerDiv.appendChild(t);this._finishRendering();this.updateMatches()}.bind(this),function(){})}},setTextContent:function(n){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null);this.textContent=n;this.divContentDone=!0},convertMatches:function(n){for(var u,e,t=0,i=0,r=this.textContent.items,o=r.length-1,h=this.findController===null?0:this.findController.state.query.length,s=[],f=0,c=n.length;f<c;f++){for(u=n[f];t!==o&&u>=i+r[t].str.length;)i+=r[t].str.length,t++;for(t===r.length&&console.error("Could not find a matching mapping"),e={begin:{divIdx:t,offset:u-i}},u+=h;t!==o&&u>i+r[t].str.length;)i+=r[t].str.length,t++;e.end={divIdx:t,offset:u-i};s.push(e)}return s},renderMatches:function(n){function p(n,t){var i=n.divIdx;e[i].textContent="";r(i,0,n.offset,t)}function r(n,t,i,r){var f=e[n],s=k[n].str.substring(t,i),o=document.createTextNode(s),u;if(r){u=document.createElement("span");u.className=r;u.appendChild(o);f.appendChild(u);return}f.appendChild(o)}var o,l,u,h,b;if(n.length!==0){var k=this.textContent.items,e=this.textDivs,t=null,a=this.pageIdx,v=this.findController===null?!1:a===this.findController.selected.pageIdx,y=this.findController===null?-1:this.findController.selected.matchIdx,d=this.findController===null?!1:this.findController.state.highlightAll,c={divIdx:-1,offset:undefined};if(o=y,l=o+1,d)o=0,l=n.length;else if(!v)return;for(u=o;u<l;u++){var w=n[u],i=w.begin,f=w.end,g=v&&u===y,s=g?" selected":"";if(this.findController&&this.findController.updateMatchPosition(a,u,e,i.divIdx,f.divIdx),t&&i.divIdx===t.divIdx?r(t.divIdx,t.offset,i.offset):(t!==null&&r(t.divIdx,t.offset,c.offset),p(i)),i.divIdx===f.divIdx)r(i.divIdx,i.offset,f.offset,"highlight"+s);else{for(r(i.divIdx,i.offset,c.offset,"highlight begin"+s),h=i.divIdx+1,b=f.divIdx;h<b;h++)e[h].className="highlight middle"+s;p(f,"highlight end"+s)}t=f}t&&r(t.divIdx,t.offset,c.offset)}},updateMatches:function(){var t,e,i,o,n,s,r;if(this.renderingDone){var u=this.matches,h=this.textDivs,c=this.textContent.items,f=-1;for(t=0,e=u.length;t<e;t++){for(i=u[t],o=Math.max(f,i.begin.divIdx),n=o,s=i.end.divIdx;n<=s;n++)r=h[n],r.textContent=c[n].str,r.className="";f=i.end.divIdx+1}this.findController!==null&&this.findController.active&&(this.matches=this.convertMatches(this.findController===null?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}},_bindMouse:function(){var n=this.textLayerDiv;n.addEventListener("mousedown",function(t){var i=n.querySelector(".endOfContent"),r,u,f;i&&(r=t.target!==n,r=r&&window.getComputedStyle(i).getPropertyValue("-moz-user-select")!=="none",r&&(u=n.getBoundingClientRect(),f=Math.max(0,(t.pageY-u.top)/u.height),i.style.top=(f*100).toFixed(2)+"%"),i.classList.add("active"))});n.addEventListener("mouseup",function(){var t=n.querySelector(".endOfContent");t&&(t.style.top="",t.classList.remove("active"))})}},n}();DefaultTextLayerFactory.prototype={createTextLayerBuilder:function(n,t,i){return new TextLayerBuilder({textLayerDiv:n,pageIndex:t,viewport:i})}}